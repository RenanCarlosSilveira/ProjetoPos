<!DOCTYPE html>
<html>
<head>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
	crossorigin="anonymous"></script>
<meta charset="UTF-8">
<title>Produto</title>
</head>
<body>
	<nav th:replace="~{fragments/header :: header}">
		<span>replace</span>
	</nav>
	<br>
	<div
		style="width: 50%; display: flex; flex-direction: column; align-items: center; margin-left: 25%;">
		<form th:action="@{/produto/produtoSave}" th:object="${produtoDTO}"
			method="POST" id="produtoSaveForm">
			<input type="hidden" class="form-control" id="id" th:field="*{id}">
			<div class="input-group mb-3">
				<img
					th:src="${produtoDTO.imagem} == null ? @{/images/no-image.png} : @{'data:image/png;base64,'+${produtoDTO.imagem}+'.jpg'}"
					style="width: 12rem;" class="rounded mx-auto d-block">
			</div>
			<div class="input-group mb-3">
				<span class="input-group-text" id="basic-addon1">Nome</span> <input
					type="text" class="form-control" aria-describedby="basic-addon1"
					id="nome" th:field="*{nome}" required>
			</div>
			<div class="input-group mb-3">
				<span class="input-group-text" id="basic-addon1">Valor</span> <input
					type="text" class="form-control" aria-describedby="basic-addon1"
					id="valor" th:field="*{valor}" required>
			</div>
			<div class="input-group mb-3">
				<span class="input-group-text" id="basic-addon1">Estoque</span> <input
					type="text" class="form-control" aria-describedby="basic-addon1"
					id="estoque" th:field="*{estoque}" required> &nbsp;&nbsp; <span
					class="input-group-text" id="basic-addon1"> √Årea</span><select
					class="form-control input-sm" id="area" style="width: 300px;"
					tabindex="30" th:field="*{area}">
					<option text="" value=""></option>
					<option th:each="area : ${areas}" th:text="${area.nome}"
						th:value="${area.name}"</option>
				</select>
			</div>
			<div class="input-group mb-3">
				<input type="file" class="form-control"
					aria-describedby="basic-addon1" id="imagemUpload" onchange="setValueImagem(this);"
					required>
				<input type="text" class="form-control"
					aria-describedby="basic-addon1" id="imagem" th:field="*{imagem}"
					required>
			</div>
			<div class="input-group mb-3">
				<span class="navbar-text"><a class="nav-link"
					th:href="@{/produto/produtoList}"><button type="button"
							class="btn btn-danger btn-sm">Voltar</button></a></span> <span
					class="navbar-text"><button type="submit"
							class="btn btn-success btn-sm">Salvar</button></span>
			</div>
		</form>

	</div>
</body>
<script>

const getFileEmBase64 = (inputFile) => {
	const fr = new FileReader();
	return new Promise((resolve, reject) => {
		fr.onerror = () => {
			fr.abort();
			reject(new DOMException("Erro ao converter arquivo."));
		};
		fr.onload = () => {
			resolve(fr.result);
		};
		fr.readAsDataURL(inputFile);
	});
};

async function setValueImagem(fileInput){
	var file = fileInput.files[0];
        if (file) {
            anexoStr = await getFileEmBase64(file);
            // remove o data:/;base64, do inicio da string em base 64
            anexoStr = anexoStr.substr(anexoStr.indexOf(',') + 1);
            document.getElementById('imagem').value = anexoStr;
        }
}

</script>
</html>